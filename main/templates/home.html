{% extends 'main.html' %}
{% load static %}

{% block content %}

<div class="container py-4">
    <div class="row g-5">

        <div class="col-lg-8">

            <h2 class="fw-bold mb-4" style="color:#1DA1F2;">Home</h2>

            {% for tweet in tweets %}
            <div class="card mb-3 border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex">
                        {% if tweet.user.profile.profile_image %}
                            <img src="{{ tweet.user.profile.profile_image.url }}" class="rounded-circle me-3" width="48" height="48">
                        {% else %}
                            <img src="{% static 'images/default.png' %}" class="rounded-circle me-3" width="48" height="48">
                        {% endif %}

                        <div class="flex-grow-1">
                            <strong>{{ tweet.user.username }}</strong>
                            <p class="mt-2 mb-3">{{ tweet.body }}</p>

                            <div class="d-flex align-items-center gap-4 text-muted small">

                                {% if request.user.is_authenticated %}
                                    <form action="{% url 'tweetLike' tweet.id %}" method="POST" class="d-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="border-0 bg-transparent d-flex align-items-center gap-1 p-0
                                            {% if request.user in tweet.likes.all %}text-danger{% else %}text-muted{% endif %}">
                                            {% if request.user in tweet.likes.all %}
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                            {% else %}
                                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                                            {% endif %}
                                            <span>{{ tweet.likes.count }}</span>
                                        </button>
                                    </form>
                                {% else %}
                                    <div class="d-flex align-items-center gap-1 text-muted">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                                        <span>{{ tweet.likes.count }}</span>
                                    </div>
                                {% endif %}

                                <a href="{% url 'tweet' tweet.id %}" class="text-muted text-decoration-none d-flex align-items-center gap-1">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                                    <span>{{ tweet.comments.count }}</span>
                                </a>

                                <span class="ms-auto">{{ tweet.created|timesince }} ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-5 text-muted">No tweets yet.</div>
            {% endfor %}

        </div>

        {% if request.user.is_authenticated %}
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm p-4 sticky-top" style="top:20px;">
                <h5 class="fw-bold mb-3">Post a new Tweet</h5>
                <form method="POST">
                    {% csrf_token %}
                    {{ form.body }}
                    <button type="submit" class="btn btn-primary w-100 mt-3" style="background:#1DA1F2;border:none;height:48px;">Post Tweet</button>
                </form>
            </div>
        </div>
        {% endif %}

    </div>
</div>

{% endblock content %}